% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/projection.r
\name{project}
\alias{project}
\title{Project a population cube forward in time}
\usage{
project(
  tp,
  h,
  level = 0.95,
  method = c("auto", "ARIMA", "ETS", "CAGR"),
  time_dim = NULL,
  guard = TRUE,
  ...
)
}
\arguments{
\item{tp}{A \code{tarr_pop} object (filtered or unfiltered) containing a time
dimension.}

\item{h}{Integer forecast horizon (number of future years).}

\item{level}{Confidence level for interval estimation (default \code{0.95}).
Values such as \code{0.95} or \code{95} are both accepted.}

\item{method}{The projection method: \code{"auto"}, \code{"ETS"}, \code{"CAGR"}, or \code{"ARIMA"}.
If \code{"auto"}, the method is inferred from the number of base years in \code{"tp"}:
\itemize{
\item 5-7 years uses \code{"ETS"}
\item 8-10 years uses  \code{"CAGR"}
\item \>10 years uses \code{"ARIMA"}
}

Fewer than 5 base years results in an error.}

\item{time_dim}{Name of the time dimension used for inference. Defaults to
\code{"year"}, which is common in \code{tarr_pop} objects.}

\item{guard}{Logical; if \code{TRUE}, prompts in interactive sessions when the
implied number of independent models is large.}

\item{...}{Additional arguments passed to the selected engine implementation.}
}
\value{
A \code{tarr_projection} object.
}
\description{
Fits independent time-series models for each non-time cell of a \code{tarr_pop}
cube and forecasts population counts for \code{h} future years. Each unique
combination of non-time dimensions (e.g., county × sex × age × race ×
ethnicity) is modeled separately.
}
\details{
The projection method may be \code{"auto"}, \code{"ETS"}, \code{"CAGR"}, or \code{"ARIMA"}.
For most use cases, \code{"auto"} is recommended and will select the appropriate
engine based on the number of base years available in the input cube.

The returned \code{tarr_projection} object contains three \code{tarr_pop} cubes:
\code{projected}, \code{lower}, and \code{upper}, along with projection metadata.
\subsection{Engine methods}{
\itemize{
\item \strong{ETS} — \emph{Exponential Smoothing State-Space models} (Error–Trend–Seasonal).
Suitable for short time series (5–7 years) where flexible trend estimation
is needed and over-parameterization should be avoided.
\item \strong{CAGR} — \emph{Compound Annual Growth Rate}. Assumes a constant annual growth
rate estimated from the base years and projects forward deterministically.
Used for moderate-length series (8–10 years) where stable growth is
preferred over stochastic modeling.
\item \strong{ARIMA} — \emph{Autoregressive Integrated Moving Average} models.
Used for longer time series (>10 years) where temporal autocorrelation
and differencing can be reliably estimated.
}
}

\subsection{Projection metadata}{

The following metadata are stored as attributes on the returned
\code{tarr_projection} object:
\itemize{
\item \strong{method} — The projection engine used (\code{"ETS"}, \code{"CAGR"}, or \code{"ARIMA"}).
\item \strong{level} — The confidence level used when computing the \code{upper} and
\code{lower} bounds.
\item \strong{source} — A character string describing the projection origin, including
source information from the originating \code{tarr_pop}.
\item \strong{base_years} — The number of historical years used to fit the model.
\item \strong{created} — Timestamp indicating when the projection was generated.
}
}
}
\examples{
# A tiny synthetic 3D cube: year × area.name × sex
dn <- list(
  year = as.character(2015:2021),     # 7 base years => "auto" selects ETS
  area.name = "Tarrant",
  sex = "female"
)
arr <- array(seq_along(dn$year), dim = c(7, 1, 1), dimnames = dn)

tp <- new_tarr_pop(
  x = DelayedArray::DelayedArray(arr),
  dimnames_list = dn,
  data_col = "population",
  source = "example"
)

\dontrun{
  pr <- project(tp, h = 3, method = "auto", level = 0.95, guard = FALSE)
  pr
  as.tarr_pop(pr, which = "projected")
}

}
\seealso{
\itemize{
\item \link{tarr_projection} for the returned object structure.
\item \code{\link[=as.tarr_pop.tarr_projection]{as.tarr_pop.tarr_projection()}} to extract one of the three cubes.
\item \code{\link[=as.data.frame.tarr_projection]{as.data.frame.tarr_projection()}} and \code{\link[=as_tibble.tarr_projection]{as_tibble.tarr_projection()}} for tabular output.
\item \code{\link[=plot.tarr_projection]{plot.tarr_projection()}} for visualization (added in the next step).
}
}
